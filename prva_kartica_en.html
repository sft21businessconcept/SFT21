<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SFT21 - Decision: Active Member without LP</title>

    <!-- ============================================= -->
    <!-- UNIVERSAL THEME INITIALIZATION SCRIPT -->
    <!-- ============================================= -->
    <script>
        function applySft21Theme() {
            try {
                const theme = localStorage.getItem('sft21_theme') || 'dark';
                if (theme === 'light') {
                    document.documentElement.classList.add('light-mode');
                } else {
                    document.documentElement.classList.remove('light-mode');
                }
                 if (window.setAnimationTheme) {
                    window.setAnimationTheme(theme);
                }
            } catch (e) {
                console.error('Error applying theme:', e);
            }
        }
        applySft21Theme();
        window.addEventListener('pageshow', function(event) {
            if (event.persisted) {
                applySft21Theme();
            }
        });
    </script>

    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Arial+Narrow&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #6a1b9a; 
            --secondary-color: #ab47bc; 
            --accent-color: #ff00ff; 
            --fluorescent-green: #80ff00; 
            --fluorescent-yellow: #ccff00;
            --text-color: #e5e7eb; 
            --background-dark: #0d0118; 
            --card-background: rgba(106, 27, 154, 0.1); 
            --card-border: rgba(171, 71, 188, 0.3); 
            --button-confirm-bg: #c0392b; 
            --button-confirm-hover-bg: #e74c3c;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; min-height: 100vh; overflow-x: hidden; overflow-y: auto; background-color: var(--background-dark); color: var(--text-color); font-family: 'Arial Narrow', Arial, sans-serif; }
        .page-wrapper { display: flex; flex-direction: column; align-items: center; padding-bottom: 40px; min-height: 100vh; width: 100%; }
        .fixed-header-container { position: fixed; top: 0; left: 0; width: 100%; z-index: 500; background-color: var(--primary-color); box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .fixed-header-container .header-content { display: flex; align-items: center; justify-content: center; position: relative; height: 3.5rem; padding-left: 1.5rem; padding-right: 4rem; max-width: 100%; margin: 0 auto; }
        .fixed-header-container .header-title { font-family: 'Arial Narrow', Arial, sans-serif; font-size: clamp(1.1rem, 2.5vw, 1.5rem); color: var(--fluorescent-green); font-weight: bold; text-align: center; text-transform: uppercase; }
        .page-close-button { position: absolute; top: 50%; right: 1rem; transform: translateY(-50%); font-size: 2.2rem; color: var(--fluorescent-green); background: none; border: none; cursor: pointer; transition: color 0.3s ease, transform 0.2s ease; line-height: 1; padding: 5px; }
        .page-close-button:hover { color: white; transform: scale(1.1) translateY(-50%); }

        .decision-content-box {
            background-color: var(--card-background); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--card-border); color: white; width: 90%; max-width: 900px; 
            margin-top: calc(3.5rem + 30px); padding: clamp(20px, 4vw, 40px); border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); font-size: clamp(0.9rem, 1.8vw, 1.05rem); line-height: 1.65;
        }
        .decision-content-box .main-congrats-title { font-family: 'Arial Narrow', Arial, sans-serif; font-size: clamp(1.1rem, 2.2vw, 1.4rem); color: white; text-align: center; margin-bottom: 25px; font-weight: bold; text-transform: uppercase; }
        
        .intro-section p { color: var(--fluorescent-yellow); margin-bottom: 12px; font-size: 1em; text-align: center; }
        .intro-section p.important { font-weight: bold; }

        .decision-content-box .highlighted-choice-title { font-size: clamp(1rem, 2vw, 1.3rem); color: var(--fluorescent-yellow); margin-top: 30px; margin-bottom: 20px; font-weight: bold; text-align: center; }
        .decision-content-box .highlighted-choice-title::before { content: "↪ "; color: var(--fluorescent-yellow); }
        .decision-content-box .highlighted-choice-title::before { content: "↪ "; color: var(--fluorescent-yellow); }
        .decision-content-box .highlighted-choice-title .arrow-span { color: var(--fluorescent-yellow);  margin-right: 8px; }       .decision-content-box .detailed-text p { margin-bottom: 15px; text-align: justify; color: white; }
        .decision-content-box .detailed-text strong { color: var(--fluorescent-green); font-weight: bold; }
        .decision-content-box .detailed-text ul { list-style: none; padding-left: 0; margin-bottom: 15px; color: white; }
        .decision-content-box .detailed-text ul li { position: relative; margin-bottom: 10px; padding-left: 20px; text-align: justify;}
        .decision-content-box .detailed-text ul li::before { content: "❖ "; color: white; font-size: 0.9em; position: absolute; left: 0; }
        .confirm-button-container { text-align: center; margin-top: 35px; }
        .confirm-button { background-color: var(--button-confirm-bg); color: white; padding: 12px 30px; border: none; border-radius: 5px; font-family: 'Arial Narrow', Arial, sans-serif; font-size: clamp(1rem, 2vw, 1.2rem); font-weight: bold; text-transform: uppercase; cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .confirm-button:hover { background-color: var(--button-confirm-hover-bg); transform: translateY(-2px); }

        .modal-overlay { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: hidden; background-color: rgba(0,0,0,0.7); justify-content: center; align-items: center; padding: 20px; }
        
        .modal-content {
            background-color: var(--background-dark); color: var(--text-color); padding: clamp(20px, 4vw, 40px);
            border: 2px solid var(--fluorescent-green); border-radius: 15px; width: 100%; max-width: 600px;
            position: relative; box-shadow: 0 0 25px rgba(128, 255, 0, 0.3); animation: fadeIn 0.3s ease-out;
            display: flex; flex-direction: column; max-height: calc(100vh - 40px);
        }
        .modal-scrollable-content { overflow-y: auto; padding-right: 15px; margin-right: -15px; padding-left: 15px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
        
        .modal-close-button {
            color: var(--fluorescent-green); position: absolute; top: 10px; right: 15px;
            font-size: 2.5rem; font-weight: bold; cursor: pointer; z-index: 10; transition: color 0.3s, transform 0.3s;
        }
        .modal-close-button:hover, .modal-close-button:focus { color: #fff; transform: scale(1.1); }
        
        .modal-content .popup-title {
            color: var(--fluorescent-green); text-align: center; font-size: clamp(1.2rem, 2.5vw, 1.6rem);
            font-weight: bold; text-transform: uppercase; margin-bottom: 20px; padding-top: 10px;
        }
        .modal-content .form-group { margin-bottom: 15px; }
        .modal-content .form-group label {
            display: block; color: var(--fluorescent-green); text-align: center;
            text-transform: uppercase; margin-bottom: 8px; font-size: 0.9rem; font-weight: bold;
        }
        .modal-content input[type="text"], .modal-content input[type="email"] {
            width: 100%; padding: 12px; border: 1px solid var(--fluorescent-green); border-radius: 4px; box-sizing: border-box;
            font-size: 1rem; background-color: rgba(0,0,0,0.2); color: var(--text-color); text-align: center;
        }
        .modal-content input::placeholder { color: #888; }
        .modal-content .email-subtitle { margin-top: 5px; margin-bottom: 8px; font-size: 0.85rem; color: #ccc; text-align: center; }
        .modal-content .napomena {
            margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--card-border);
            font-size: 0.85rem; line-height: 1.5; color: #bbb; text-align: left;
        }
        .modal-content .napomena p { color: #bbb; margin-bottom: 0.3em; text-align: justify; }
        .modal-content .napomena strong { color: var(--fluorescent-yellow); }

        .error-message { color: #ff4d4d; font-size: 0.85rem; height: 1.2em; margin-top: 5px; text-align: center; }
        .input-error { border-color: #ff4d4d !important; box-shadow: 0 0 8px rgba(255, 77, 77, 0.7); }

        .modal-confirm-button {
            display: block; margin: 20px auto 0; padding: 12px 35px; font-size: 1.1rem; font-weight: bold;
            text-transform: uppercase; color: var(--background-dark); background-color: var(--fluorescent-green);
            border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease, opacity 0.3s ease;
        }
        .modal-confirm-button:hover:not(:disabled) { background-color: #fff; transform: translateY(-2px); }
        .modal-confirm-button:disabled { background-color: #586351; color: #999; opacity: 0.7; cursor: not-allowed; transform: none; }

        .final-popup-title { font-size: clamp(1.4rem, 3vw, 1.8rem) !important; }
        #final-confirmation-message { text-align: center; line-height: 1.6; font-size: 1.1rem; }
        #final-confirmation-message b { color: var(--fluorescent-yellow); }

        .animated-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; background-color: var(--background-dark); }
        #network-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; }
        .bg-dots { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px); background-size: 20px 20px; opacity: 0.5; }
        .glow { position: absolute; border-radius: 50%; background: radial-gradient(circle, rgba(171, 71, 188, 0.2) 0%, rgba(171, 71, 188, 0) 70%); filter: blur(50px); pointer-events: none; }
    </style>
    <!-- ============================================= -->
    <!-- STYLES FOR LIGHT MODE -->
    <!-- ============================================= -->
    <style>
        html.light-mode body { background-color: #f8fafc !important; color: #334155 !important; }
        html.light-mode .fixed-header-container { background-color: var(--primary-color) !important; }
        html.light-mode .header-title, html.light-mode .page-close-button { color: var(--fluorescent-green) !important; }
        html.light-mode .page-close-button:hover { color: white !important; }
        html.light-mode .decision-content-box { background-color: #ffffff !important; border-color: #e2e8f0 !important; box-shadow: 0 4px 15px rgba(0,0,0,0.05) !important; }
        html.light-mode .main-congrats-title, html.light-mode .detailed-text p, html.light-mode .detailed-text ul { color: #334155 !important; }
        html.light-mode .detailed-text ul li::before { color: #334155 !important; }
        html.light-mode .intro-section p, html.light-mode .highlighted-choice-title, html.light-mode .highlighted-choice-title::before { color: #842a9d !important; }        html.light-mode .detailed-text strong { color: var(--primary-color) !important; }
        html.light-mode .confirm-button { background-color: #dc2626 !important; }
        html.light-mode .confirm-button:hover { background-color: #ef4444 !important; }
        html.light-mode .modal-content { background-color: #ffffff; border-color: var(--primary-color); }
        html.light-mode .modal-close-button, html.light-mode .popup-title, html.light-mode .form-group label { color: var(--primary-color); }
        html.light-mode .modal-close-button:hover { color: #333; }
        html.light-mode input[type="text"], html.light-mode input[type="email"] { background-color: #f1f5f9; border-color: #cbd5e1; color: #1e293b; }
        html.light-mode input::placeholder { color: #94a3b8; }
        html.light-mode .email-subtitle, html.light-mode .napomena p { color: #475569; }
        html.light-mode .napomena strong { color: var(--primary-color); }
        html.light-mode .modal-confirm-button { background-color: var(--primary-color); color: white; }
        html.light-mode .modal-confirm-button:hover:not(:disabled) { background-color: var(--secondary-color); }
        html.light-mode #final-confirmation-message b { color: var(--primary-color); }
        html.light-mode .animated-background { background-color: transparent !important; }
        html.light-mode #network-canvas { background-color: transparent !important; }
    </style>
</head>
<body>
    <canvas id="network-canvas"></canvas>
    <div class="animated-background">
        <div class="bg-dots"></div>
        <div class="glow" style="top: 10%; left: 10%; width: 400px; height: 400px;"></div>
        <div class="glow" style="top: 70%; left: 80%; width: 350px; height: 350px; opacity: 0.15;"></div>
    </div>

    <div class="fixed-header-container">
        <div class="header-content">
            <span class="header-title">SFT21 - Decision on Business Continuation</span>
            <button class="page-close-button" id="closePageButton" title="Close">×</button>
        </div>
    </div>

    <div class="page-wrapper">
        <div class="decision-content-box">
            <h1 class="main-congrats-title">CONGRATULATIONS AND THANK YOU FOR YOUR DECISION TO JOIN US IN CONTINUING BUSINESS ACCORDING TO THE RULES OF THE NEW BUSINESS SYSTEM</h1>
            
            <div class="intro-section">
                <p>Given the changes in the business model and the distribution of funds,</p>
                <p class="important">The Franchise Agreement you previously signed is no longer valid.</p>
                <p>You will sign a new Franchise Agreement after activating a new Starter Package.</p>
                <p id="initialInvestmentInfo">Considering you started your business in the old system with 30 $ and have decided that;</p>
            </div>
            
            <h2 class="highlighted-choice-title">
                YOU DO NOT WISH to purchase a License Package...
            </h2>
            <div class="detailed-text">
                <p>... you will continue your business as an <strong>ACTIVE</strong> member, (<strong>SFstarter</strong> - if you have less than 1450 SFpoints, or <strong>SFfranchisee</strong> - if you have more than 1450 SFpoints), by opening a <strong>personal (PA) or business (BA)</strong> user account with the <strong>"SPfree"</strong> starter package.</p>
                <p>During the first filling of positions in the SFalgorithm, your account will take a position according to the number of your <strong>personal</strong> or <strong>group SFpoints</strong> from the old system. Based on the payment of <span id="startAmountDisplay">30 $</span> for the Starter Package from the old system, you will receive <strong>60 personal SFpoints</strong> which will be transferred to the new system.</p>
                <ul>
                    <li><strong>Group SFpoints</strong> are obtained by adding the sum of the personal points of your direct and indirect members who are also continuing their business to your personal SFpoints. Accordingly, 50% of the total personal SFpoints of your direct members and 25% of the total personal SFpoints of their direct members (your indirect members) are added to your SFpoints. If you upgraded your account in the old system, the earnings from the reserve wallet are added to your SFpoints, such that for every 1 SFC, you get 1 SFb. If you had a certain amount of SFC in your wallet, that amount is also counted towards your SFpoints, with 1 SFC equaling 2 SFb.</li>
                    <li>The <strong>Maximum Earnings Limit (MEL)</strong> that you can receive in one accounting period will be determined based on the number of your SFpoints.</li>
                </ul>
                <p>After your account takes its position in the SFalgorithm, you will continue according to the new business rules with the "SPfree" starter package and a newly determined MEL, which you can increase (up to a max of 2100 SFC) by paying for new subscription periods or by building your career through registering new members – SFfranchisees (up to a max of 100,000 SFC).</p>
                <p>It is important to note that you have the RIGHT AND OPPORTUNITY to recommend the business opportunity of purchasing a License Package to others, and thus you are entitled to a 10% Referral Bonus, which in this case can be a maximum amount up to ten times the value of your starter package payment from the old system.</p>
            </div>

            <div class="confirm-button-container">
                <button class="confirm-button" id="openPopupForConfirmation">CONFIRM SELECTION</button>
            </div>
        </div>
    </div>
    
    <!-- MAIN POPUP HTML STRUCTURE -->
    <div id="confirmationUserDetailsPopup" class="modal-overlay">
        <div class="modal-content">
             <span id="closeUserDetailsPopupButton" class="modal-close-button" title="Close">×</span>
            <h2 class="popup-title">CONFIRM YOUR DATA</h2>
            <div class="modal-scrollable-content">
                <div class="form-group">
                    <label for="usernameInputPopup">Username</label>
                    <input type="text" id="usernameInputPopup" maxlength="21" placeholder="Your username from the old system">
                </div>
                <div class="form-group">
                    <label for="oldEmailInputPopup">Email Address</label>
                     <p class="email-subtitle">(the one you registered with in the old system)</p>
                    <input type="email" id="oldEmailInputPopup" placeholder="Old email address">
                    <div id="oldEmailErrorPopup" class="error-message"></div>
                </div>
                <div class="form-group">
                     <label for="newEmailInputPopup">New Email Address (optional)</label>
                    <p class="email-subtitle">If you no longer use or have access to your old address, please enter a new one.</p>
                    <input type="email" id="newEmailInputPopup" placeholder="New email address">
                    <div id="newEmailErrorPopup" class="error-message"></div>
                </div>
                <div class="napomena">
                    <strong>Note:</strong>
                    <p>The continuation of business operations will begin with the first filling of the SFalgorithm, about which you will be timely notified via email. If you later decide to take the opportunity to invest in the development of the SFT21 Business Concept, you can always do so on the Investment Packages page, as long as the offer is available.</p>
                </div>
            </div>
            <button id="confirmUserDetailsButton" class="modal-confirm-button">Confirm</button>
        </div>
    </div>

    <!-- FINAL CONFIRMATION POPUP HTML STRUCTURE -->
    <div id="finalConfirmationPopup" class="modal-overlay">
        <div class="modal-content">
            <h2 class="popup-title final-popup-title">Information</h2>
            <p id="final-confirmation-message"></p>
        </div>
    </div>

     <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbyhhosQJfFDf8-_jLkLeycTECYUWaUBiaEMuS7kSGKiDkTVHuaPIwWolBrgMJgl-zuS/exec';   
            // --- ELEMENT SELECTORS ---
            const closePageButton = document.getElementById('closePageButton');
            const mainPopup = document.getElementById('confirmationUserDetailsPopup');
            const openMainPopupButton = document.getElementById('openPopupForConfirmation');
            const closeMainPopupButton = document.getElementById('closeUserDetailsPopupButton');
            const finalPopup = document.getElementById('finalConfirmationPopup');
            const finalMessageP = document.getElementById('final-confirmation-message');
            const usernameInput = document.getElementById('usernameInputPopup');
            const oldEmailInput = document.getElementById('oldEmailInputPopup');
            const newEmailInput = document.getElementById('newEmailInputPopup');
            const confirmButton = document.getElementById('confirmUserDetailsButton');

            // --- HELPER FUNCTIONS ---
            const isEmailValid = (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(email).toLowerCase());
            const closeMainPopup = () => { if(mainPopup) mainPopup.style.display = 'none'; document.body.style.overflow = 'auto'; };
            const closeFinalPopup = () => { if(finalPopup) finalPopup.style.display = 'none'; document.body.style.overflow = 'auto'; };

            const validateForm = () => {
                const isUsernameValid = usernameInput.value.trim() !== '';
                const isOldEmailValid = isEmailValid(oldEmailInput.value.trim());
                const newEmailValue = newEmailInput.value.trim();
                const isNewEmailValidOrEmpty = newEmailValue === '' || isEmailValid(newEmailValue);
                confirmButton.disabled = !(isUsernameValid && isOldEmailValid && isNewEmailValidOrEmpty);
            };
            
            // --- EVENT LISTENERS ---
            if (closePageButton) {
                closePageButton.onclick = function() {
                    window.location.href = 'prikaz_opcije_en.html' + window.location.search; 
                };
            }

            openMainPopupButton.addEventListener('click', () => {
                mainPopup.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                validateForm();
            });

            closeMainPopupButton.addEventListener('click', closeMainPopup);
            mainPopup.addEventListener('click', (event) => { if (event.target === mainPopup) closeMainPopup(); });
            finalPopup.addEventListener('click', (event) => { if (event.target === finalPopup) closeFinalPopup(); });
            [usernameInput, oldEmailInput, newEmailInput].forEach(input => input.addEventListener('input', validateForm));

            // --- MAIN LOGIC FOR DATA SUBMISSION ---
            confirmButton.addEventListener('click', () => {
                if(confirmButton.disabled) return;
                
                closeMainPopup();
                finalMessageP.innerHTML = `<h4>Sending...</h4><p>Please wait.</p>`;
                finalPopup.style.display = 'flex';
                document.body.style.overflow = 'hidden';

                const dataToSend = new FormData();
                dataToSend.append('requestType', 'activeNoInvest');
                dataToSend.append('username', usernameInput.value.trim());
                dataToSend.append('oldEmail', oldEmailInput.value.trim());
                dataToSend.append('newEmail', newEmailInput.value.trim());

                fetch(WEBAPP_URL, {
                    method: 'POST',
                    body: dataToSend
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        finalMessageP.innerHTML = 'Your decision has been recorded. We will contact you in a timely manner. Thank you.';
                    } else {
                        finalMessageP.innerHTML = 'An error occurred. Please try again.';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    finalMessageP.innerHTML = 'A network error occurred. Please check your connection and try again.';
                })
                .finally(() => {
                setTimeout(() => {
                closeFinalPopup();
                window.location.href = 'index_en.html'; 
                }, 5000);
                });
            });

            // --- DYNAMIC TEXT AND ANIMATIONS ---
            const urlParams = new URLSearchParams(window.location.search);
            const paramIznos = urlParams.get('iznos');
            const paramValuta = urlParams.get('valuta');
            const initialInvestmentInfo = document.getElementById('initialInvestmentInfo');
            const startAmountDisplay = document.getElementById('startAmountDisplay');
            let displayText = "30 $"; 
            if (paramIznos && paramValuta) {
                if (paramIznos === 'veci' && paramValuta === 'iznos') {
                     displayText = "a larger investment amount"; 
                } else {
                    const currencySymbol = paramValuta.toLowerCase() === 'usd' ? '$' : '€';
                    displayText = `${paramIznos} ${currencySymbol}`;
                }
            }
            if (initialInvestmentInfo) {
                initialInvestmentInfo.innerHTML = `Considering you started your business in the old system with <strong>${displayText}</strong> and have decided that;`;
            }
            if (startAmountDisplay) {
                if (paramIznos === 'veci' && paramValuta === 'iznos') {
                    const parentParagraph = startAmountDisplay.closest('p');
                    if (parentParagraph) parentParagraph.innerHTML = "Based on the total amount invested from the old system, the number of SFpoints transferred to the new system will be determined.";
                } else {
                     startAmountDisplay.textContent = displayText;
                }
            }
            if (typeof gsap !== 'undefined') {
                gsap.from('.decision-content-box', { duration: 1, y: 50, opacity: 0, ease: 'power3.out', delay: 0.3 });
                gsap.from(['.main-congrats-title', '.intro-section > *', '.highlighted-choice-title', '.detailed-text > *', '.confirm-button-container'], 
                    { duration: 0.7, opacity: 0, y: 20, stagger: 0.1, ease: 'power2.out', delay: 0.6 }
                );
            }
        });
    </script>
    <!-- Background Animation Script -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const canvas = document.getElementById('network-canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        let particles = [];
        const darkOptions = { particleColorRGB: '128, 255, 0', lineColorRGB: '170, 0, 255', particleAmount: 120, defaultRadius: 1.3, linkRadius: 150, particleSpeed: 0.25, lineWidth: 0.4 };
        const lightOptions = { particleColorRGB: '106, 27, 154', lineColorRGB: '171, 71, 188', particleAmount: 120, defaultRadius: 1.3, linkRadius: 150, particleSpeed: 0.25, lineWidth: 0.4 };
        let currentOptions = document.documentElement.classList.contains('light-mode') ? lightOptions : darkOptions;

        const resizeCanvas = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; initParticles(); };
        window.addEventListener('resize', resizeCanvas);

        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height;
                this.radius = currentOptions.defaultRadius;
                this.vx = (Math.random() - 0.5) * currentOptions.particleSpeed;
                this.vy = (Math.random() - 0.5) * currentOptions.particleSpeed;
            }
            draw() {
                ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(${currentOptions.particleColorRGB}, 0.85)`; ctx.fill();
            }
            update() {
                this.x += this.vx; this.y += this.vy;
                if (this.x > canvas.width || this.x < 0) this.vx = -this.vx;
                if (this.y > canvas.height || this.y < 0) this.vy = -this.vy;
            }
        }

        const initParticles = () => {
            particles = [];
            for (let i = 0; i < currentOptions.particleAmount; i++) {
                particles.push(new Particle());
            }
        };

        const animate = () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animate);
        };

        window.setAnimationTheme = (theme) => {
            currentOptions = (theme === 'light') ? lightOptions : darkOptions;
            initParticles();
        };
        
        resizeCanvas();
        animate();
    });
    </script>
</body>
</html>